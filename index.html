<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="./stylesheets/style.css"/>
    <title>CRC Survey</title>
  </head>
  <body>
    <div class="container">
        <header class="d-flex flex-wrap justify-content-center py-3 mb-4">
            <div class="row">
                <div class="col-6">
                    <a href="https://crc.global/" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-dark text-decoration-none">
                      <img src="./images/CRC_Global-RGB.png" width="150" height="32"></img>
                    </a>
                </div>
                <div class="col-6">
                    <span class="fs-5">Brookings, South Dakota</span>
                </div>
            </div>
          </header>
          <div class="input-group mb-3">
            <span class="input-group-text" id="basic-addon1">Full Name</span>
            <input id="fullName" type="text" class="form-control" placeholder="Peter Smith" aria-label="fullname" aria-describedby="basic-addon1">
          </div>

          <div class="input-group mb-3">
            <span class="input-group-text" id="basic-addon1">Phone Number</span>
            <input id="phone" type="text" class="form-control" name="phone" placeholder="(000)000-0000" aria-label="phone" aria-describedby="basic-addon1">
          </div>

          <div class="input-group mb-3">
            <span class="input-group-text" id="basic-addon1">Email</span>
            <input id="email" type="text" class="form-control" name="email" placeholder="peter.smith@domain.com" aria-label="phone" aria-describedby="basic-addon1">
          </div>
          
          <div class="input-group mb-3">
            <label class="input-group-text" for="position">Position Intereseted</label>
            <select class="form-select" id="position">
              <option value="No answered" selected>Choose...</option>
              <option value="Lead Forklift Operator">Lead Forklift Operator</option>
              <option value="Forklit Operator">Forklit Operator</option>
              <option value="General Labor">General Labor</option>
            </select>
          </div>

          <div class="input-group mb-3">
            <label class="input-group-text" for="location">Location</label>
            <select class="form-select" id="location">
              <option value="No answered" selected>Choose...</option>
              <option value="Lubbock">Lubbock</option>
              <option value="Indianapolis">Indianapolis</option>
              <option value="Brookings">Brookings</option>
              <option value="Houston">Houston</option>
            </select>
          </div>

          <div class="input-group mb-3">
            <label class="input-group-text" for="employeeStatus">What's your current employment status?</label>
            <select class="form-select" id="employeeStatus">
              <option value="No answered" selected>Choose...</option>
              <option value="Current Employed">Current Employed</option>
              <option value="Self-Employed">Self-Employed</option>
              <option value="Unemployed">Unemployed</option>
              <option value="Student">Student</option>
            </select>
          </div>

          <div class="input-group mb-3">
            <label class="input-group-text" id="basic-addon1" for="startDate">When can you start?</label>
            <input id="startDate" class="form-control" type="date" />
          </div>

          <div class="mb-3">
            <label for="formFile" class="form-label">Upload your Resume</label>
            <input  class="form-control" type="file" id="formFile">
            <!-- <button id="upload-button" class="btn btn-secondary" onclick="uploadFile()"> Upload file </button> -->
          </div>

          <button type="button" class="btn btn-outline-success submit" onclick="submit()">Submit</button>
    </div>


    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"
      integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"
      integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13"
      crossorigin="anonymous"
    ></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script type="text/javascript">
        $("input[name='phone']").on("keyup", function(){
            $("input[name='phone']").val(destroyMask(this.value));
            this.value = createMask($("input[name='phone']").val());
        })

        function createMask(string){
            return string.replace(/(\d{3})(\d{3})(\d{4})/,"($1)$2-$3");
        }

        function destroyMask(string){
            return string.replace(/\D/g,'').substring(0, 10);
        }

        async function uploadFile() {
          //creating form data object and append file into that form data
          let formData = new FormData();
          let count = 0;

          try{
            if(formFile.files[0]){
              formData.append("file", formFile.files[0]);
              count++;
            }else{
                Swal.fire({
                title: 'Error!',
                text: 'Please upload a file and try again!',
                icon: 'error',
                confirmButtonText: 'OK'
              })
            }
          }catch(error){
            Swal.fire({
              title: 'Error!',
              text: 'Something wrong happened! Please contact the administrator.',
              icon: 'error',
              confirmButtonText: 'OK'
            })
          }

          try{
            if(document.getElementById('fullName').value !== ""){
              formData.append("completeName",document.getElementById('fullName').value);
              count++;
            }else{
              Swal.fire({
                title: 'Error!',
                text: 'Please enter your full name and try again!',
                icon: 'error',
                confirmButtonText: 'OK'
              })
            }
          }catch(error){
            Swal.fire({
              title: 'Error!',
              text: 'Something wrong happened! Please contact the administrator.',
              icon: 'error',
              confirmButtonText: 'OK'
            })
          }

          try{
            if(document.getElementById('email').value !== ""){
              formData.append("email",document.getElementById('email').value);
              count++;
            }else{
              Swal.fire({
                title: 'Error!',
                text: 'Please enter your email and try again!',
                icon: 'error',
                confirmButtonText: 'OK'
              })
            }
          }catch(error){
            Swal.fire({
              title: 'Error!',
              text: 'Something wrong happened! Please contact the administrator.',
              icon: 'error',
              confirmButtonText: 'OK'
            })
          }

          try{
            if(document.getElementById('phone').value !== ""){
              formData.append("phone",document.getElementById('phone').value);
              count++;
            }else{
              Swal.fire({
                title: 'Error!',
                text: 'Please enter your phone number and try again!',
                icon: 'error',
                confirmButtonText: 'OK'
              })
            }
          }catch(error){
            Swal.fire({
              title: 'Error!',
              text: 'Something wrong happened! Please contact the administrator.',
              icon: 'error',
              confirmButtonText: 'OK'
            })
          }

          try{
            if(document.getElementById('startDate').value !== ""){
              formData.append("startDate",document.getElementById('startDate').value);
              count++;
            }else{
              Swal.fire({
                title: 'Error!',
                text: 'Please enter a date and try again!',
                icon: 'error',
                confirmButtonText: 'OK'
              })
            }
          }catch(error){
            Swal.fire({
              title: 'Error!',
              text: 'Something wrong happened! Please contact the administrator.',
              icon: 'error',
              confirmButtonText: 'OK'
            })
          }

          try{
            if(document.getElementById('position').value !== "No answered"){
              formData.append("position",document.getElementById('position').value);
              count++;
            }else{
              Swal.fire({
                title: 'Error!',
                text: 'Please select a position and try again!',
                icon: 'error',
                confirmButtonText: 'OK'
              })
            }
          }catch(error){
            Swal.fire({
              title: 'Error!',
              text: 'Something wrong happened! Please contact the administrator.',
              icon: 'error',
              confirmButtonText: 'OK'
            })
          }

          try{
            if(document.getElementById('location').value !== "No answered"){
              formData.append("location",document.getElementById('location').value);
              count++;
            }else{
              Swal.fire({
                title: 'Error!',
                text: 'Please enter a location and try again!',
                icon: 'error',
                confirmButtonText: 'OK'
              })
            }
          }catch(error){
            Swal.fire({
              title: 'Error!',
              text: 'Something wrong happened! Please contact the administrator.',
              icon: 'error',
              confirmButtonText: 'OK'
            })
          }

          try{
            if(formFile.files[0]){
              formData.append("resumeName",formFile.files[0].name);
              count++;
            }else{
              Swal.fire({
                title: 'Error!',
                text: 'Please upload a file and try again!',
                icon: 'error',
                confirmButtonText: 'OK'
              })
            }
          }catch(error){
            Swal.fire({
              title: 'Error!',
              text: 'Something wrong happened! Please contact the administrator.',
              icon: 'error',
              confirmButtonText: 'OK'
            })
          }
          
          try{
            if(document.getElementById('employeeStatus').value !== "No answered"){
              formData.append("employeeStatus",document.getElementById('employeeStatus').value);
              count++;
            }else{
              Swal.fire({
                title: 'Error!',
                text: 'Please enter your employee status and try again!',
                icon: 'error',
                confirmButtonText: 'OK'
              })
            }
          }catch(error){
            Swal.fire({
              title: 'Error!',
              text: 'Something wrong happened! Please contact the administrator.',
              icon: 'error',
              confirmButtonText: 'OK'
            })
          }

          if(count === 9){
            //network request using POST method of fetch
            await fetch('http://localhost:3000/upload', { 
              mode:'no-cors',
              method: "POST", 
              body: formData,
              files: formFile.files[0]
            }).then((response) => {
  
              if(response.status === 200){
                Swal.fire({
                  title: 'Success!',
                  text: 'Thank you for joining our family!',
                  icon: 'success',
                  confirmButtonText: 'OK'
                })
              }else if(response.status === 500){
                Swal.fire({
                  title: 'Error!',
                  text: 'Something wrong happened! Please contact the administrator.',
                  icon: 'error',
                  confirmButtonText: 'OK'
                })
              }
            }).catch((error)=>{
              console.log(error)
            });
          }
        }

        async function submit(){
          uploadFile();
        }
       
    </script>
  </body>
</html>
